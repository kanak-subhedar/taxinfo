<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CSV Report Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="description" content="Upload CSV and instantly generate visual reports. Works fully in browser. No backend required.">
<meta name="keywords" content="CSV report, excel graph generator, financial report tool">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f7fa;
  margin: 0;
  padding: 20px;
}
.container {
  max-width: 1200px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 8px;
}
h1 { color: #1a237e; }
.instructions {
  background: #eef2ff;
  padding: 15px;
  border-left: 5px solid #1a237e;
  margin-bottom: 20px;
}
input[type="file"] {
  margin: 15px 0;
}
button {
  padding: 10px 20px;
  background: #1a237e;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
button:hover {
  background: #303f9f;
}
canvas {
  margin: 30px 0;
  background: #fafafa;
  border: 1px solid #ddd;
}
.error {
  color: red;
  font-weight: bold;
}
</style>
</head>

<body>
<div class="container">

<h1>CSV Report Generator</h1>

<div class="instructions">
<b>CSV Format Requirements:</b>
<ul>
<li><b>Date</b> – Any valid date</li>
<li><b>Category</b> – Text category</li>
<li><b>Amount</b> – Numeric</li>
<li><b>Type</b> – Income or Expense</li>
</ul>
<p>✔ Column order does not matter<br>
✔ Extra columns allowed<br>
✔ Entire CSV is processed</p>
</div>

<input type="file" id="csvFile" accept=".csv">
<br>
<button onclick="generateReport()">Generate Report</button>

<p id="error" class="error"></p>

<canvas id="barChart" width="1100" height="400"></canvas>
<canvas id="pieChart" width="500" height="400"></canvas>
<canvas id="lineChart" width="1100" height="400"></canvas>

</div>

<script>
let parsedData = [];

function generateReport() {
  const file = document.getElementById("csvFile").files[0];
  if (!file) return showError("Please upload a CSV file.");

  const reader = new FileReader();
  reader.onload = e => parseCSV(e.target.result);
  reader.readAsText(file);
}

function parseCSV(text) {
  parsedData = [];
  const rows = text.trim().split("\n").map(r => r.split(","));
  const headers = rows[0].map(h => h.trim().toLowerCase());

  const required = ["date","category","amount","type"];
  for (let r of required) {
    if (!headers.includes(r)) return showError("Missing column: " + r);
  }

  const idx = {
    date: headers.indexOf("date"),
    category: headers.indexOf("category"),
    amount: headers.indexOf("amount"),
    type: headers.indexOf("type")
  };

  for (let i = 1; i < rows.length; i++) {
    const row = rows[i];
    parsedData.push({
      date: new Date(row[idx.date]),
      category: row[idx.category],
      amount: parseFloat(row[idx.amount]),
      type: row[idx.type].toLowerCase()
    });
  }

  drawCharts();
}

function showError(msg) {
  document.getElementById("error").innerText = msg;
}

function drawCharts() {
  document.getElementById("error").innerText = "";
  drawBarChart();
  drawPieChart();
  drawLineChart();
}

function drawBarChart() {
  const canvas = document.getElementById("barChart");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const totals = {};
  parsedData.forEach(d => {
    totals[d.category] = (totals[d.category] || 0) + d.amount;
  });

  const keys = Object.keys(totals);
  const max = Math.max(...Object.values(totals));
  const barWidth = 800 / keys.length;

  keys.forEach((k,i) => {
    const h = (totals[k] / max) * 300;
    ctx.fillStyle = "#3f51b5";
    ctx.fillRect(50 + i*barWidth, 350-h, barWidth-10, h);
    ctx.fillText(k, 50 + i*barWidth, 370);
  });
}

function drawPieChart() {
  const canvas = document.getElementById("pieChart");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);

  let income = 0, expense = 0;
  parsedData.forEach(d => {
    if (d.type === "income") income += d.amount;
    else expense += d.amount;
  });

  const total = income + expense;
  let angle = 0;

  const slices = [
    {value: income, color:"#4caf50"},
    {value: expense, color:"#f44336"}
  ];

  slices.forEach(s => {
    const slice = (s.value / total) * Math.PI * 2;
    ctx.beginPath();
    ctx.moveTo(250,200);
    ctx.arc(250,200,150,angle,angle+slice);
    ctx.fillStyle = s.color;
    ctx.fill();
    angle += slice;
  });
}

function drawLineChart() {
  const canvas = document.getElementById("lineChart");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const sorted = parsedData.sort((a,b)=>a.date-b.date);
  const max = Math.max(...sorted.map(d=>d.amount));

  ctx.beginPath();
  ctx.moveTo(50,350);

  sorted.forEach((d,i)=>{
    const x = 50 + (i * 900 / sorted.length);
    const y = 350 - (d.amount / max) * 300;
    ctx.lineTo(x,y);
  });

  ctx.strokeStyle = "#ff9800";
  ctx.stroke();
}
</script>

</body>
</html>
