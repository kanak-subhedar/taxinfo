<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CSV Financial Report Generator</title>

<meta name="description" content="Upload CSV data and instantly generate labeled, explained financial charts. 100% browser-based, no backend required.">
<meta name="keywords" content="CSV chart generator, financial report, excel visualization, income expense chart">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
}
.container {
  max-width:1100px;
  margin:auto;
  padding:20px;
}
.box {
  background:#fff;
  padding:20px;
  margin-bottom:25px;
  border-radius:8px;
  border:1px solid #ddd;
}
h1 { text-align:center; }
button {
  padding:10px 16px;
  background:#1f6feb;
  color:#fff;
  border:none;
  cursor:pointer;
  border-radius:4px;
}
button:hover { background:#164fa1; }
.error { color:red; font-weight:bold; }
.explain { font-size:14px; color:#444; margin-top:8px; }
canvas {
  margin-top: 20px;
  width: 100% !important;
  height: 380px !important;
}

</style>
</head>

<body>
<div class="container">

<h1>CSV Report Generator</h1>

<div class="box">
<h3>Required CSV Headers</h3>
<ul>
<li><b>date</b> – transaction date</li>
<li><b>type</b> – income or expense</li>
<li><b>category</b> – category name</li>
<li><b>amount</b> – numeric value</li>
</ul>
<input type="file" id="csvFile" accept=".csv">
<br><br>
<button onclick="generateReport()">Generate Report</button>
<p id="error" class="error"></p>
</div>

<div class="box">
<canvas id="barChart"></canvas>
<p class="explain">
This bar chart compares <b>total income vs total expense</b>.  
Higher expense than income indicates negative cash flow.
</p>
</div>

<div class="box">
<canvas id="pieChart"></canvas>
<p class="explain">
This pie chart shows <b>where money is being spent</b> across categories.
</p>
</div>

<div class="box">
<canvas id="lineChart"></canvas>
<p class="explain">
This line chart shows the <b>overall financial trend over time</b>.
</p>
</div>

</div>

<script>
let barChart, pieChart, lineChart;

function generateReport() {
  const file = document.getElementById("csvFile").files[0];
  const err = document.getElementById("error");
  err.textContent = "";

  if (!file) {
    err.textContent = "Please upload a CSV file.";
    return;
  }

  const reader = new FileReader();
  reader.onload = e => parseCSV(e.target.result);
  reader.readAsText(file);
}

function parseCSV(data) {
  const rows = data.trim().split("\n").map(r => r.split(","));
  const headers = rows[0].map(h => h.trim().toLowerCase());

  const d = headers.indexOf("date");
  const t = headers.indexOf("type");
  const c = headers.indexOf("category");
  const a = headers.indexOf("amount");

  if ([d,t,c,a].includes(-1)) {
    document.getElementById("error").textContent =
      "Missing required headers: date, type, category, amount";
    return;
  }

  let income = 0, expense = 0;
  const catMap = {};
  const dateMap = {};

  for (let i=1;i<rows.length;i++) {
    const amt = parseFloat(rows[i][a]);
    if (isNaN(amt)) continue;

    const type = rows[i][t].toLowerCase();
    const cat = rows[i][c];
    const date = rows[i][d];

    if (type === "income") income += amt;
    if (type === "expense") {
      expense += amt;
      catMap[cat] = (catMap[cat] || 0) + amt;
    }
    dateMap[date] = (dateMap[date] || 0) + amt;
  }

  drawCharts(income, expense, catMap, dateMap);
}

function drawCharts(income, expense, catMap, dateMap) {
  if (barChart) barChart.destroy();
  if (pieChart) pieChart.destroy();
  if (lineChart) lineChart.destroy();

  barChart = new Chart(barChartEl(), {
    type: "bar",
    data: {
      labels: ["Income","Expense"],
      datasets: [{
        label: "Amount (₹)",
        data: [income, expense],
        backgroundColor: ["#2ecc71","#e74c3c"]
      }]
    },
    options: {
      plugins: {
        legend: { display: true },
        title: { display:true, text:"Income vs Expense" },
        tooltip: {
          callbacks: {
            label: ctx => `₹ ${ctx.parsed.y.toLocaleString()}`
          }
        }
      },
      scales: {
        y: { title:{ display:true, text:"Amount (₹)" } }
      }
    }
  });

  pieChart = new Chart(pieChartEl(), {
    type: "pie",
    data: {
      labels: Object.keys(catMap),
      datasets: [{
        data: Object.values(catMap),
        backgroundColor:[
          "#3498db","#9b59b6","#f1c40f","#1abc9c","#e67e22"
        ]
      }]
    },
    options: {
      plugins: {
        legend:{ display:true, position:"bottom" },
        title:{ display:true, text:"Expense Distribution" },
        tooltip:{
          callbacks:{
            label: ctx => `${ctx.label}: ₹ ${ctx.parsed}`
          }
        }
      }
    }
  });

  const sortedDates = Object.keys(dateMap).sort();

  lineChart = new Chart(lineChartEl(), {
    type: "line",
    data: {
      labels: sortedDates,
      datasets: [{
        label: "Net Amount",
        data: sortedDates.map(d => dateMap[d]),
        borderColor:"#1f6feb",
        fill:false,
        tension:0.3
      }]
    },
    options: {
      plugins:{
        legend:{ display:true },
        title:{ display:true, text:"Financial Trend Over Time" }
      },
      scales:{
        x:{ title:{ display:true, text:"Date" } },
        y:{ title:{ display:true, text:"Amount (₹)" } }
      }
    }
  });
}

function barChartEl(){ return document.getElementById("barChart"); }
function pieChartEl(){ return document.getElementById("pieChart"); }
function lineChartEl(){ return document.getElementById("lineChart"); }
</script>

</body>
</html>
