<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Advanced CSV Report Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f3f4f6;
  margin: 0;
}
.container {
  max-width: 1200px;
  margin: auto;
  padding: 20px;
}
.box {
  background: #ffffff;
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 25px;
  border: 1px solid #ddd;
}
h1, h2 { text-align: center; }

button {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 4px;
  cursor: pointer;
}
button:hover { background: #1e40af; }

.error { color: red; font-weight: bold; }

.log {
  background: #020617;
  color: #e5e7eb;
  padding: 10px;
  font-family: monospace;
  height: 160px;
  overflow-y: auto;
}

.chart-box {
  display: flex;
  justify-content: center;
}

.chart-fixed {
  width: 420px;
  height: 420px;
}

canvas {
  max-width: 100%;
  max-height: 100%;
}

.explain {
  font-size: 14px;
  color: #444;
  margin-top: 6px;
  text-align: center;
}

/* SUMMARY PAGE GRID */
.chart-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 25px;
}
.chart-grid canvas {
  max-height: 260px;
}
</style>
</head>

<body>
<div class="container">

<h1>CSV Sales & Performance Analyzer</h1>

<div class="box">
<h3>Required CSV Headers</h3>
<p>
Product_Name, Quantity, Product_Price, City, Date,  
Sales_Amount, Purchase_Amount, Seller_Name, Gain
</p>

<input type="file" id="csvFile" accept=".csv">
<br><br>
<button onclick="start()">Generate Report</button>
<p id="error" class="error"></p>
</div>

<div class="box">
<h3>Execution Log</h3>
<div id="log" class="log"></div>
</div>

<div class="box">
<canvas id="barChart"></canvas>
<p class="explain">Sales by product (hover to see quantity).</p>
</div>

<div class="box">
<div class="chart-box">
  <div class="chart-fixed">
    <canvas id="pieChart"></canvas>
  </div>
</div>
<p class="explain">City-wise sales distribution.</p>
</div>

<div class="box">
<div class="chart-box">
  <div class="chart-fixed">
    <canvas id="doughnutChart"></canvas>
  </div>
</div>
<p class="explain">Sales vs Purchase comparison.</p>
</div>

<div class="box">
<canvas id="lineChart"></canvas>
<p class="explain">Gain trend over time.</p>
</div>

<div class="box">
<canvas id="sellerChart"></canvas>
<p class="explain">Seller performance based on total sales, quantity & gain.</p>
</div>

<!-- ================= SUMMARY PAGE ================= -->

<div class="box" style="page-break-before:always;">
<h2>ðŸ“Š All Reports â€“ Summary View</h2>
<p class="explain">
Complete consolidated view of all reports for quick review, sharing, or printing.
</p>
</div>

<div class="box chart-grid">
  <canvas id="summaryBar"></canvas>
  <canvas id="summaryPie"></canvas>
  <canvas id="summaryDoughnut"></canvas>
  <canvas id="summaryLine"></canvas>
  <canvas id="summarySeller"></canvas>
</div>

</div>

<script>
let charts = [];

function log(msg) {
  const el = document.getElementById("log");
  el.textContent += msg + "\n";
  el.scrollTop = el.scrollHeight;
}

function start() {
  document.getElementById("log").textContent = "";
  document.getElementById("error").textContent = "";

  const file = document.getElementById("csvFile").files[0];
  if (!file) {
    document.getElementById("error").textContent = "Upload a CSV file.";
    return;
  }

  log("Reading CSV...");
  const reader = new FileReader();
  reader.onload = e => parseCSV(e.target.result);
  reader.readAsText(file);
}

function parseCSV(text) {
  const rows = text.trim().split("\n").map(r => r.split(","));
  const headers = rows[0].map(h => h.trim().toLowerCase());

  const idx = {};
  [
    "product_name","quantity","product_price","city","date",
    "sales_amount","purchase_amount","seller_name","gain"
  ].forEach(c => idx[c] = headers.indexOf(c));

  const prodSales={}, prodQty={}, city={}, gainByDate={};
  const sellerSales={}, sellerQty={}, sellerGain={};
  let totalSales=0, totalPurchase=0;

  for (let i=1;i<rows.length;i++){
    const r=rows[i];
    const p=r[idx.product_name], s=r[idx.seller_name];
    const q=+r[idx.quantity], sa=+r[idx.sales_amount], pa=+r[idx.purchase_amount], g=+r[idx.gain];
    prodSales[p]=(prodSales[p]||0)+sa;
    prodQty[p]=(prodQty[p]||0)+q;
    city[r[idx.city]]=(city[r[idx.city]]||0)+sa;
    gainByDate[r[idx.date]]=(gainByDate[r[idx.date]]||0)+g;
    sellerSales[s]=(sellerSales[s]||0)+sa;
    sellerQty[s]=(sellerQty[s]||0)+q;
    sellerGain[s]=(sellerGain[s]||0)+g;
    totalSales+=sa||0;
    totalPurchase+=pa||0;
  }

  renderCharts(prodSales,prodQty,city,totalSales,totalPurchase,gainByDate,sellerSales,sellerQty,sellerGain);
}

function destroyAll(){ charts.forEach(c=>c.destroy()); charts=[]; }

function renderCharts(prodSales,prodQty,city,totalSales,totalPurchase,gainByDate,sellerSales,sellerQty,sellerGain){
  destroyAll();

  charts.push(new Chart(barChart,{type:"bar",data:{labels:Object.keys(prodSales),datasets:[{data:Object.values(prodSales),label:"Sales"}]},options:{plugins:{tooltip:{callbacks:{afterLabel:c=>"Qty: "+prodQty[c.label]}}}}}));

  charts.push(new Chart(pieChart,{type:"pie",data:{labels:Object.keys(city),datasets:[{data:Object.values(city)}]}}));

  charts.push(new Chart(doughnutChart,{type:"doughnut",data:{labels:["Sales","Purchase"],datasets:[{data:[totalSales,totalPurchase]}]}}));

  const d=Object.keys(gainByDate).sort();
  charts.push(new Chart(lineChart,{type:"line",data:{labels:d,datasets:[{data:d.map(x=>gainByDate[x]),label:"Gain"}]}}));

  charts.push(new Chart(sellerChart,{type:"bar",data:{labels:Object.keys(sellerSales),datasets:[{data:Object.values(sellerSales),label:"Seller Sales"}]},options:{indexAxis:"y"}}));

  charts.push(new Chart(summaryBar,{type:"bar",data:{labels:Object.keys(prodSales),datasets:[{data:Object.values(prodSales),label:"Sales"}]}}));
  charts.push(new Chart(summaryPie,{type:"pie",data:{labels:Object.keys(city),datasets:[{data:Object.values(city)}]}}));
  charts.push(new Chart(summaryDoughnut,{type:"doughnut",data:{labels:["Sales","Purchase"],datasets:[{data:[totalSales,totalPurchase]}]}}));
  charts.push(new Chart(summaryLine,{type:"line",data:{labels:d,datasets:[{data:d.map(x=>gainByDate[x]),label:"Gain"}]}}));
  charts.push(new Chart(summarySeller,{type:"bar",data:{labels:Object.keys(sellerSales),datasets:[{data:Object.values(sellerSales),label:"Seller Sales"}]},options:{indexAxis:"y"}}));
}
</script>
</body>
</html>
