<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced CSV Report Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1"></script>
<script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f3f4f6;
  margin: 0;
}
.container {
  max-width: 1200px;
  margin: auto;
  padding: 20px;
}
.box {
  background: #fff;
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 30px;
  border: 1px solid #ddd;
}
h1, h2 {
  text-align: center;
}

button {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 4px;
  cursor: pointer;
}
button:hover { background: #1e40af; }

.log {
  background: #020617;
  color: #e5e7eb;
  padding: 10px;
  font-family: monospace;
  height: 160px;
  overflow-y: auto;
}

canvas {
  width: 100% !important;
  height: 420px !important;
}

.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(520px, 1fr));
  gap: 40px;
}

.summary-box {
  background: #fafafa;
  border: 1px solid #ccc;
  padding: 15px;
  border-radius: 8px;
}

.summary-box canvas {
  height: 360px !important;
}

.explain {
  text-align: center;
  color: #444;
  font-size: 14px;
}
</style>
</head>

<body>
<div class="container">

<h1>CSV Sales & Performance Analyzer</h1>

<div class="box">
<h3>Required CSV Headers</h3>
<p>
Product_Name, Quantity, Product_Price, City, Date,  
Sales_Amount, Purchase_Amount, Seller_Name, Gain
</p>
<input type="file" id="csvFile" accept=".csv">
<br><br>
<button onclick="start()">Generate Report</button>
</div>

<div class="box">
<h3>Execution Log</h3>
<div id="log" class="log"></div>
</div>

<div class="box"><canvas id="barChart"></canvas></div>
<div class="box"><canvas id="pieChart"></canvas></div>
<div class="box"><canvas id="doughnutChart"></canvas></div>
<div class="box"><canvas id="lineChart"></canvas></div>
<div class="box"><canvas id="sellerChart"></canvas></div>

<!-- ================= SUMMARY PAGE ================= -->

<div class="box" style="page-break-before:always;">
<h2>ðŸ“Š All Reports â€“ Summary View</h2>
<p class="explain">Readable, printable, management-ready consolidated report</p>
</div>

<div class="summary-grid">
  <div class="summary-box"><canvas id="summaryBar"></canvas></div>
  <div class="summary-box"><canvas id="summaryPie"></canvas></div>
  <div class="summary-box"><canvas id="summaryDoughnut"></canvas></div>
  <div class="summary-box"><canvas id="summaryLine"></canvas></div>
  <div class="summary-box"><canvas id="summarySeller"></canvas></div>
</div>

</div>

<script>
let charts = [];

function log(msg) {
  const el = document.getElementById("log");
  el.textContent += msg + "\n";
  el.scrollTop = el.scrollHeight;
}

function start() {
  document.getElementById("log").textContent = "";
  const file = document.getElementById("csvFile").files[0];
  if (!file) return;

  log("Reading CSV...");
  const reader = new FileReader();
  reader.onload = e => parseCSV(e.target.result);
  reader.readAsText(file);
}

function parseCSV(text) {
  const rows = text.trim().split("\n").map(r => r.split(","));
  const h = rows[0].map(x => x.toLowerCase().trim());
  const i = c => h.indexOf(c);

  const ps={}, pq={}, city={}, gain={}, ss={}, sq={}, sg={};
  let ts=0,tp=0;

  for (let r=1;r<rows.length;r++){
    const row=rows[r];
    const p=row[i("product_name")];
    const s=row[i("seller_name")];
    const q=+row[i("quantity")];
    const sa=+row[i("sales_amount")];
    const pa=+row[i("purchase_amount")];
    const g=+row[i("gain")];
    const d=row[i("date")];

    ps[p]=(ps[p]||0)+sa; pq[p]=(pq[p]||0)+q;
    city[row[i("city")]]=(city[row[i("city")]]||0)+sa;
    gain[d]=(gain[d]||0)+g;
    ss[s]=(ss[s]||0)+sa; sq[s]=(sq[s]||0)+q; sg[s]=(sg[s]||0)+g;
    ts+=sa||0; tp+=pa||0;
  }

  render(ps,pq,city,ts,tp,gain,ss,sq,sg);
}

function baseOptions(title){
  return {
    responsive:true,
    maintainAspectRatio:true,
    plugins:{
      title:{display:true,text:title,font:{size:18}},
      legend:{labels:{font:{size:14}}},
      tooltip:{bodyFont:{size:14},titleFont:{size:14}}
    },
    scales:{
      x:{ticks:{font:{size:13}}},
      y:{ticks:{font:{size:13}}}
    }
  };
}

function render(ps,pq,city,ts,tp,gain,ss,sq,sg){
  charts.forEach(c=>c.destroy()); charts=[];
  const dates=Object.keys(gain).sort();

  charts.push(new Chart(barChart,{type:"bar",data:{labels:Object.keys(ps),datasets:[{label:"Sales",data:Object.values(ps)}]},options:baseOptions("Sales by Product")}));
  charts.push(new Chart(pieChart,{type:"pie",data:{labels:Object.keys(city),datasets:[{data:Object.values(city)}]},options:{...baseOptions("City-wise Sales"),aspectRatio:1}}));
  charts.push(new Chart(doughnutChart,{type:"doughnut",data:{labels:["Sales","Purchase"],datasets:[{data:[ts,tp]}]},options:{...baseOptions("Sales vs Purchase"),aspectRatio:1}}));
  charts.push(new Chart(lineChart,{type:"line",data:{labels:dates,datasets:[{label:"Gain",data:dates.map(d=>gain[d])}]},options:baseOptions("Gain Trend")}));
  charts.push(new Chart(sellerChart,{type:"bar",data:{labels:Object.keys(ss),datasets:[{label:"Seller Sales",data:Object.values(ss)}]},options:{...baseOptions("Seller Performance"),indexAxis:"y"}}));

  charts.push(new Chart(summaryBar,{type:"bar",data:{labels:Object.keys(ps),datasets:[{data:Object.values(ps)}]},options:baseOptions("Product Sales Summary")}));
  charts.push(new Chart(summaryPie,{type:"pie",data:{labels:Object.keys(city),datasets:[{data:Object.values(city)}]},options:{...baseOptions("City Summary"),aspectRatio:1}}));
  charts.push(new Chart(summaryDoughnut,{type:"doughnut",data:{labels:["Sales","Purchase"],datasets:[{data:[ts,tp]}]},options:{...baseOptions("Sales vs Purchase Summary"),aspectRatio:1}}));
  charts.push(new Chart(summaryLine,{type:"line",data:{labels:dates,datasets:[{data:dates.map(d=>gain[d])}]},options:baseOptions("Gain Summary")}));
  charts.push(new Chart(summarySeller,{type:"bar",data:{labels:Object.keys(ss),datasets:[{data:Object.values(ss)}]},options:{...baseOptions("Seller Summary"),indexAxis:"y"}}));
}
</script>
</body>
</html>
