---
layout: default
---
{% include script10.html %}
<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Google Add-Sense code -->
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6272193760158994"
        crossorigin="anonymous"></script>	
  <meta charset="utf-8">
  <title>Loan EMI & Eligibility Checker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 900px; margin:auto; }
    input, select { padding:8px; margin:6px 0; width:100%; box-sizing: border-box; }
    .row { display:flex; gap:10px; }
    .col { flex:1; }
    .card { padding:12px; border: 1px solid #ddd; border-radius:8px; margin-bottom:12px; }
    button { padding:10px 14px; }
    pre { background:#f7f7f7; padding:10px; overflow:auto; }
  </style>
</head>
<body>
  <h2>Advanced Loan EMI & Eligibility Checker</h2>
  <div class="card">
    <h4>Loan Inputs</h4>
    <div class="row">
      <div class="col">
        <label>Loan Amount (₹)</label>
        <input id="principal" type="number" value="1500000">
      </div>
      <div class="col">
        <label>Tenure (years)</label>
        <input id="tenure" type="number" value="15">
      </div>
    </div>

    <div class="row">
      <div class="col">
        <label>Extra monthly payment (optional) ₹</label>
        <input id="extra" type="number" value="0">
      </div>
      <div class="col">
        <label>Choose lenders (Ctrl/Command to multi-select)</label>
        <select id="lenders" multiple size="3">
          {% for l in lenders %}
            <option value="{{l.id}}">{{l.name}} — {{l.annual_rate_percent}}% p.a.</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <button onclick="calculate()">Calculate EMI & Amortization</button>
  </div>

  <div class="card">
    <h4>User Profile (for eligibility)</h4>
    <div class="row">
      <div class="col"><label>Monthly income (₹)</label><input id="income" type="number" value="60000"></div>
      <div class="col"><label>Existing EMI (monthly) ₹</label><input id="existing_emi" type="number" value="5000"></div>
    </div>
    <div class="row">
      <div class="col"><label>Age</label><input id="age" type="number" value="30"></div>
      <div class="col"><label>Employment months</label><input id="employment_months" type="number" value="36"></div>
    </div>
    <div class="row">
      <div class="col"><label>Credit score (CIBIL approx)</label><input id="credit_score" type="number" value="710"></div>
      <div class="col"><label></label><button onclick="checkEligibility()">Check Eligibility</button></div>
    </div>
  </div>

  <div id="output" class="card">
    <h4>Results</h4>
    <div id="resultsArea">No results yet.</div>
  </div>

<script>
function getSelectedLenders() {
  const sel = document.getElementById('lenders');
  let chosen = [];
  for (let i=0; i<sel.options.length; i++){
    if (sel.options[i].selected) chosen.push(sel.options[i].value);
  }
  return chosen;
}

async function calculate(){
  const principal = parseFloat(document.getElementById('principal').value) || 0;
  const tenure = parseFloat(document.getElementById('tenure').value) || 0;
  const extra = parseFloat(document.getElementById('extra').value) || 0;
  const lenders = getSelectedLenders();

  const payload = { principal: principal, tenure_years: tenure, lenders: lenders, extra_monthly_payment: extra };
  const res = await fetch('/api/calculate', {
    method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload)
  });
  const data = await res.json();
  displayCalculate(data);
}

function displayCalculate(data){
  let html = `<strong>Loan:</strong> ₹${data.principal} for ${data.tenure_years} years<br/><br/>`;
  for (const c of data.comparisons){
    html += `<div style="border-top:1px dashed #ccc;margin-top:8px;padding-top:8px;">`;
    html += `<b>${c.lender_name}</b> — ${c.annual_rate_percent}% p.a. | EMI: ₹${c.emi} | Months to repay (with extra): ${c.months_paid}<br/>Total payment: ₹${c.total_payment} | Total interest: ₹${c.total_interest}<br/>`;
    html += `<details><summary>Show amortization (first 12 rows)</summary><pre>${JSON.stringify(c.schedule.slice(0,12), null, 2)}</pre></details>`;
    html += `</div>`;
  }
  document.getElementById('resultsArea').innerHTML = html;
}

async function checkEligibility(){
  const principal = parseFloat(document.getElementById('principal').value) || 0;
  const tenure = parseFloat(document.getElementById('tenure').value) || 0;
  const user = {
    monthly_income: parseFloat(document.getElementById('income').value) || 0,
    existing_emi: parseFloat(document.getElementById('existing_emi').value) || 0,
    age: parseInt(document.getElementById('age').value) || 0,
    employment_months: parseInt(document.getElementById('employment_months').value) || 0,
    credit_score: parseInt(document.getElementById('credit_score').value) || 0
  };
  const payload = { principal: principal, tenure_years: tenure, user: user };
  const res = await fetch('/api/eligibility', {
    method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload)
  });
  const data = await res.json();
  displayEligibility(data);
}

function displayEligibility(data){
  let html = `<strong>User summary:</strong> Monthly income ₹${data.user.monthly_income}, existing EMI ₹${data.user.existing_emi}, age ${data.user.age}, credit score ${data.user.credit_score}<br/><br/>`;
  for (const r of data.results){
    html += `<div style="border-top:1px solid #eee;padding-top:8px;margin-top:8px;">`;
    html += `<b>${r.lender_name}</b> — Rate ${r.annual_rate_percent}% p.a. | EMI for requested loan: ₹${r.emi_for_requested_loan}<br/>Max affordable loan (same tenure): ₹${r.max_affordable_loan_for_user}<br/>Decision: <b>${r.eligibility.decision}</b><br/>`;
    if (r.eligibility.reasons.length){
      html += `<ul>`;
      for (const reason of r.eligibility.reasons) html += `<li>${reason}</li>`;
      html += `</ul>`;
    }
    html += `</div>`;
  }
  document.getElementById('resultsArea').innerHTML = html;
}
</script>
</body>
</html>

  
